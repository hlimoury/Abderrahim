<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Scoring - <%= supermarket.name %></title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
</head>
<body class="bg-light">
<div class="container mt-5">
  <h1 class="text-center mb-4">Scoring - <%= supermarket.name %></h1>

  <!-- 1) Sécurité Incendie -->
  <div class="card p-4 mb-4">
    <h2>Sécurité Incendie</h2>
    <% if (incendieRows.length > 0) { %>
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="table-dark">
            <tr>
              <th>Sous-indicateur</th>
              <th>Niveau (%)</th>
              <th>Objectif (%)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% incendieRows.forEach(row => { %>
              <tr>
                <td><%= row.indicatorName %></td>
                <td><%= row.niveau.toFixed(2) %></td>
                <td><%= row.objectif.toFixed(2) %></td>
                <td>
                  <a href="/supermarket/<%= supermarket._id %>/scoring/<%= row._id %>/edit" class="btn btn-warning btn-sm">Edit</a>
                  <form action="/supermarket/<%= supermarket._id %>/scoring/<%= row._id %>/delete" method="POST" style="display:inline-block;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Supprimer ce sous-indicateur ?');">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p>Aucun sous-indicateur ajouté.</p>
    <% } %>

    <!-- Add new row to incendie -->
    <form action="/supermarket/<%= supermarket._id %>/scoring/add" method="POST" class="mt-3 d-flex gap-2">
      <input type="hidden" name="sectionType" value="incendie">
      <select name="indicatorName" class="form-select" style="max-width: 220px;">
        <option value="Risque Incendie">Risque Incendie</option>
        <option value="Extincteurs+RIA">Extincteurs + RIA</option>
        <option value="Désenfumage+Évacuation">Désenfumage + Évacuation</option>
      </select>
      <input type="number" step="0.01" name="niveau" class="form-control" placeholder="Niveau (%)">
      <input type="number" step="0.01" name="objectif" class="form-control" placeholder="Objectif (%)">
      <button type="submit" class="btn btn-success">Ajouter</button>
    </form>
  </div>

  <!-- 2) Sécurité et Santé au Travail -->
  <div class="card p-4 mb-4">
    <h2>Sécurité et Santé au Travail</h2>
    <% if (sstRows.length > 0) { %>
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="table-dark">
            <tr>
              <th>Sous-indicateur</th>
              <th>Niveau (%)</th>
              <th>Objectif (%)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% sstRows.forEach(row => { %>
              <tr>
                <td><%= row.indicatorName %></td>
                <td><%= row.niveau.toFixed(2) %></td>
                <td><%= row.objectif.toFixed(2) %></td>
                <td>
                  <a href="/supermarket/<%= supermarket._id %>/scoring/<%= row._id %>/edit" class="btn btn-warning btn-sm">Edit</a>
                  <form action="/supermarket/<%= supermarket._id %>/scoring/<%= row._id %>/delete" method="POST" style="display:inline-block;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Supprimer ce sous-indicateur ?');">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p>Aucun sous-indicateur ajouté.</p>
    <% } %>

    <!-- Add new row to sst -->
    <form action="/supermarket/<%= supermarket._id %>/scoring/add" method="POST" class="mt-3 d-flex gap-2">
      <input type="hidden" name="sectionType" value="sst">
      <select name="indicatorName" class="form-select" style="max-width: 280px;">
        <option value="Organisation Sécurité">Organisation Sécurité</option>
        <option value="Risque Électrique">Risque Électrique</option>
        <option value="RM+Réserve+Frigos+Labos">RM+Réserve+Frigos+Labos</option>
        <option value="Mise en Rayon+Caisse">Mise en Rayon+Caisse</option>
        <option value="Locaux Sociaux">Locaux Sociaux</option>
      </select>
      <input type="number" step="0.01" name="niveau" class="form-control" placeholder="Niveau (%)">
      <input type="number" step="0.01" name="objectif" class="form-control" placeholder="Objectif (%)">
      <button type="submit" class="btn btn-success">Ajouter</button>
    </form>
  </div>

  <!-- 3) Sûreté -->
  <div class="card p-4 mb-4">
    <h2>Sûreté</h2>
    <% if (sureteRows.length > 0) { %>
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="table-dark">
            <tr>
              <th>Sous-indicateur</th>
              <th>Niveau (%)</th>
              <th>Objectif (%)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% sureteRows.forEach(row => { %>
              <tr>
                <td><%= row.indicatorName %></td>
                <td><%= row.niveau.toFixed(2) %></td>
                <td><%= row.objectif.toFixed(2) %></td>
                <td>
                  <a href="/supermarket/<%= supermarket._id %>/scoring/<%= row._id %>/edit" class="btn btn-warning btn-sm">Edit</a>
                  <form action="/supermarket/<%= supermarket._id %>/scoring/<%= row._id %>/delete" method="POST" style="display:inline-block;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Supprimer ce sous-indicateur ?');">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p>Aucun sous-indicateur ajouté.</p>
    <% } %>

    <!-- Add new row to surete -->
    <form action="/supermarket/<%= supermarket._id %>/scoring/add" method="POST" class="mt-3 d-flex gap-2">
      <input type="hidden" name="sectionType" value="surete">
      <select name="indicatorName" class="form-select" style="max-width: 350px;">
        <option value="Vidéosurveillance+Intrusion">Vidéosurveillance+Intrusion</option>
        <option value="Flux des biens et des personnes">Flux des biens et des personnes</option>
        <option value="Registres Sécurité">Registres Sécurité</option>
        <option value="Sûreté et Sécurité Station Service">Sûreté et Sécurité Station Service</option>
        <option value="Sécurité des Fonds">Sécurité des Fonds</option>
      </select>
      <input type="number" step="0.01" name="niveau" class="form-control" placeholder="Niveau (%)">
      <input type="number" step="0.01" name="objectif" class="form-control" placeholder="Objectif (%)">
      <button type="submit" class="btn btn-success">Ajouter</button>
    </form>
  </div>

  <!-- 4) Niveau de Sécurité Global -->
  <div class="card p-4 mb-4">
    <h2>Niveau de Sécurité Global du Site vs Objectifs</h2>
    <p>(Voici la moyenne des pourcentages de chaque section, et la moyenne globale.)</p>

    <table class="table table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Thème</th>
          <th>Niveau (%)</th>
          <th>Objectifs (%)</th>
        </tr>
      </thead>
      <tbody>
        <!-- Per-section average -->
        <tr>
          <td>Sécurité Incendie</td>
          <td><%= incendieNiveau.toFixed(2) %></td>
          <td><%= incendieObjectif.toFixed(2) %></td>
        </tr>
        <tr>
          <td>Sécurité et Santé au Travail</td>
          <td><%= sstNiveau.toFixed(2) %></td>
          <td><%= sstObjectif.toFixed(2) %></td>
        </tr>
        <tr>
          <td>Sûreté</td>
          <td><%= sureteNiveau.toFixed(2) %></td>
          <td><%= sureteObjectif.toFixed(2) %></td>
        </tr>
        <!-- Overall average across all sub-indicators -->
        <tr class="table-info">
          <td>Niveau de Sécurité Global du Site</td>
          <td><%= globalNiveau.toFixed(2) %></td>
          <td><%= globalObjectif.toFixed(2) %></td>
        </tr>
      </tbody>
    </table>
  </div>

  <a href="/supermarket/<%= supermarket._id %>" class="btn btn-secondary">Retour</a>
</div>
</body>
</html>
